<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default}">

<body>
<div layout:fragment="content1">
    <div class="breadcrumb breadcrumb-style-one mb-0">
        <div class="container">
            <div class="col-lg-12 text-center">
                <h1 class="breadcrumb-title">Auction Details</h1>
                <ul class="d-flex justify-content-center breadcrumb-items">
                    <li class="breadcrumb-item"><i class="bi bi-house-door"></i> <a href="../index.html">Home</a></li>
                    <li class="breadcrumb-item active">Auction Details</li>
                </ul>
            </div>
        </div>
    </div>

    <section class="auction-details-section pt-110">
        <div class="container">
            <div class="row gy-5">
                <div class="col-lg-6">
                    <div class="item-bid-timer">
                        <div class="auction-bid">
                            <p>현재입찰가</p>
                            <h5 th:text="'₩'+ ${#numbers.formatDecimal(productDetail.currentPrice, 0, 'COMMA', 0, 'POINT')}"></h5>
                        </div>
                        <script>
                            // 서버로부터 받은 경매 마감 시간을 자바스크립트 변수에 저장
                            const auctionEndTime = /*[[${productDetail.endTime}]]*/ '2024-08-07T12:00:00Z';
                            let timerInterval = null;
                        </script>
                        <div class="auction-timer">
                            <div class="countdown">
                                <h6><span id="days4"></span>D :
                                    <span id="hours4"></span>H :
                                    <span id="minutes4"></span>M :
                                    <span id="seconds4"></span>S</h6>
                            </div>
                        </div>
                        <script>
                            // 타이머를 시작하는 함수
                            function startCountdown(endTime) {
                                const end = new Date(endTime).getTime();
                                if (timerInterval !== null) {
                                    clearInterval(timerInterval);
                                }

                                // 1초마다 갱신
                                const x = setInterval(function() {
                                    const now = new Date().getTime();
                                    const distance = end - now;

                                    // 시간 계산
                                    const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                                    const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                    const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                                    const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                                    // 결과를 각 span에 삽입
                                    document.getElementById("days4").innerHTML = days;
                                    document.getElementById("hours4").innerHTML = hours;
                                    document.getElementById("minutes4").innerHTML = minutes;
                                    document.getElementById("seconds4").innerHTML = seconds;
                                    document.querySelector(".auction-timer").style.visibility = "visible";
                                    // 타이머 종료 시 동작
                                    if (distance < 0) {
                                        clearInterval(x);
                                        document.getElementById("timer4").innerHTML = "Auction Ended";
                                    }
                                }, 1000);
                            }

                            // 페이지 로드 시 카운트다운 시작
                            window.onload = function() {
                                startCountdown(auctionEndTime);
                            };
                        </script>
                    </div>

                    <!-- 상품 이미지를 하얀 박스 위에 표시 -->
                    <div class="product-image-box">
                        <img th:src="${productDetail.imgUrl}" alt="상품 이미지" class="product-image">
                    </div>

                    <ul class="nav small-image-list d-flex justify-content-md-between justify-content-center gap-md-4 gap-2">
                        <li class="nav-item">
                            <div id="details-img1">
                                <img src="assets/images/product/details1.png" alt="">
                            </div>
                        </li>
                        <li class="nav-item">
                            <div id="details-img2">
                                <img src="assets/images/product/details2.png" alt="">
                            </div>
                        </li>
                        <li class="nav-item">
                            <div id="details-img3">
                                <img src="assets/images/product/details3.png" alt="">
                            </div>
                        </li>
                        <li class="nav-item">
                            <div id="details-img4">
                                <img src="assets/images/product/details4.png" alt="">
                            </div>
                        </li>
                        <li class="nav-item">
                            <div id="details-img5">
                                <img src="assets/images/product/details5.png" alt="">
                            </div>
                        </li>
                    </ul>
                </div>
                <div class="col-lg-6">
                    <div class="widget-right-area">
                        <div class="single-widget">
                            <h5 class="widget-title">Product Overview</h5>
                            <ul class="widget-list">
                                <li><span>상품명 :</span><span th:text="${productDetail.name}">상품명</span></li>
                                <li><span>판매자 ID :</span><span th:text="${productDetail.memberId}">판매자</span></li>
                                <li><span>카테고리 :</span><span id="end-time" th:text="${productDetail.category}">카테고리</span></li>
                                <li><span>경매 마감 시간 :</span><span th:text="${productDetail.endTime}">경매 마감 시간</span></li>
                                <!--경매 마감 시간 뒤에 .0제거하기                               -->
                                <script>
                                    document.addEventListener('DOMContentLoaded', function() {
                                        var endTimeElement = document.getElementById('end-time');
                                        var endTimeText = endTimeElement.textContent;

                                        // 문자열에서 '.0'을 제거
                                        if (endTimeText.endsWith('.0')) {
                                            endTimeText = endTimeText.slice(0, -2);
                                            endTimeElement.textContent = endTimeText;
                                        }
                                    });
                                </script>
                                <li><span>즉시 구매가 :</span><span th:text="${productDetail.immediatePrice}">즉시 구매가</span></li>
                                <li><span>상품 설명 :</span><span th:text="${productDetail.description}">상품 설명</span></li>
                            </ul>
                        </div>
                        <div class="single-widget">
                            <h5 class="wdget-title wdget-title2">Bid Now</h5>
                            <p class="widget-subtitle">Bid Amount : Minimum Bid 20.00$</p>
                            <form class="widget-form">
                                <div class="form-group d-flex justify-content-center align-items-center">
                                    <input type="text" placeholder="$00.00">
                                    <button class="widget-btn">Place Bid</button>
                                </div>
                            </form>
                        </div>
                        <div class="single-widget">
                            <h5 class="wdget-title">Bidding History</h5>
                            <div class="bidding-item gap-sm-4 gap-2">
                                <div class="bidding-img">
                                    <img src="assets/images/buyer/bid-histo1.png" alt="">
                                </div>
                                <div class="bidding-content">
                                    <h6><a href="../winner.html">Robart FOX</a></h6>
                                    <p>Bid 23 minutes ago for 24.5$</p>
                                </div>
                            </div>
                            <div class="bidding-item gap-sm-4 gap-2">
                                <div class="bidding-img">
                                    <img src="assets/images/buyer/bid-histo2.png" alt="">
                                </div>
                                <div class="bidding-content">
                                    <h6><a href="../winner.html">Leslie Alexander</a></h6>
                                    <p>Bid 23 minutes ago for 24.5$</p>
                                </div>
                            </div>
                            <div class="bidding-item gap-sm-4 gap-2">
                                <div class="bidding-img">
                                    <img src="assets/images/buyer/bid-hidto3.png" alt="">
                                </div>
                                <div class="bidding-content">
                                    <h6><a href="../winner.html">Jane Cooper</a></h6>
                                    <p>Bid 23 minutes ago for 24.5$</p>
                                </div>
                            </div>
                        </div>

                        <div class="details-social-area">
                            <h5 class="wdget-title">Share Now</h5>
                            <ul>
                                <li><a href="https://www.facebook.com"><i class='bx bxl-facebook'></i></a></li>
                                <li><a href="https://twitter.com"><i class='bx bxl-twitter'></i></a></li>
                                <li><a href="https://www.pinterest.com"><i class='bx bxl-pinterest-alt'></i></a></li>
                                <li><a href="https://www.instagram.com"><i class='bx bxl-instagram'></i></a></li>
                            </ul>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </section>
</div>
</body>
</html>
